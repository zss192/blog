---
title: 互联网+反爬虫核心技术说明
tags:
  - 日常办公
categories:
  - 日常办公
date: 2020-07-03 12:56:00
---
# 现有爬虫缺点

现有反爬虫技术缺点(根据这个图片手动画个这样的图)

![image-20200703123131973](https://cdn.jsdelivr.net/gh/zss192/Typora-notes@master/images/image-20200703123131973.png)

现有的网络爬虫检测和防御方案，通过检测用户(包括网络爬虫)的访问频率,行为模式等,进行对恶意网络爬虫的识别。
这种方案的弊端是，网络爬虫的编写者有足够的时间和精力，针对静态的HTML(而咱们的项目就是让静态页面变成动态的)。

# 本项目实现过程及优点

Web页面动态化，即改变HTML及其他静态资源原本的静态、单一、确定等特性通过动态加密和动态陷阱技术将静态资源进行动态化处理，消除因静态所带来的易匹配、易批量化请求的缺陷。另外本项目采用自适应调整动态频率降低因动态化带来的系统开销。

> 简单来说就是用动态加密和动态陷阱进行动态处理，为避免过度消耗系统资源用自适应调整动态频率来调整

## 恶意爬虫主动防御流程图

> 把这个流程图加到PPT中(不要放图片，手动画一个流程图)

![image-20200704103929986](https://cdn.jsdelivr.net/gh/zss192/Typora-notes@master/images/image-20200704103929986.png)

## 动态加密

用动态加密的方式对静态属性进行动态加密处理，使得每次响应的HTML代码中原有的HTML静态属性发生动态变化，且具有不可逆向和不可预测性，增大了爬虫编写过程前期分析阶段的难度。从而主动地将恶意爬出限制在分析阶段，有效的保障Web应用的安全性和服务质量。

### 实现过程

![image-20200704102711974](https://cdn.jsdelivr.net/gh/zss192/Typora-notes@master/images/image-20200704102711974.png)

(1)：首先，抽取 HTML 页面中待加密的标签，记为SA；为了能够动态的进行加密，选择密钥串 S 平均切分，得到 SFront 和 SLast

(2)：利用随机数生成算法生成随机序列 R ，替换原密钥串中的后半部分SLast ，得到 S *，即为动态密钥

(3)：使用 Rijndael 加密算法对静态标签 SA 进行加密得到密文的后半部分 DLast

(4)：随机序列R和和密钥串S后半部分SLast 进行异或得到密文的前半部分 DFront

(5)：组合DFront 和 DLast 得到加密后的动态化 HTML 标签 

![image-20200704103302496](https://cdn.jsdelivr.net/gh/zss192/Typora-notes@master/images/image-20200704103302496.png)

(6)：发生请求时，先提取 HTML 代码中的动态化标签D ，将其平均切分得到 DFront DLast 

(7)：从数据库中读取该标签所对应的密钥串 S ，平均切分得到SFront 和 SLast 

(8)：DFront和和密钥串S后半部分SLast 进行异或得到随机序列 R

(9)：SFront和随机序列R组合获取动态密钥 S *

(10)：用 Rijndael 解密即可得到原来的静态 HTML标签 SA

## 动态陷阱

此外，利用动态陷阱技术，动态陷阱的目标是动态地加入隐藏 DOM 树节点，消除 DOM 树结构导致的静态路径问题，使HTML在动态加密静态属性之后动态混淆DOM层级关系从而避免利用xPath等selector方式进行精准定位。

> 例如在路径 ’/html/body/div[5]/dl/dd/ul/li[7]/div[2]/div[1]/a’中添加任意节点都会改变指向当前 a节点的路径

### 实现过程

1.对于插入点的选取：根据设定需要防护的内容首先找到该内容所处 节点的路径，DOM 树节点的精准路径会因为该节点的先辈节点和前驱同胞节点的增减而变化，故选取插入点的方式便是在其先辈节点中进行插入或在其前面插入同胞节点。

2.对于插入内容选取：首先，插入的 DOM 节点均为 HTML 中的合法节点即可满足不影响代码正常执行；动态插入的 节点中不包含内容且不与已有节点产生冲突即可满足不影响页面显示；满足以上两点的 tag 类型可以自行构造，因此满足不可预测性。

3.基于梅森旋转算法的插入机制：插入机制通过随机选择的方式从插入点和插入内容中进行选取，为了能够提升随机性和不可预测 性，需要对插入位置和插入内容进行随机选择，用DOM树的层级结构的相对位置，消除 DOM 路径的 单一性和可匹配性。

## 自适应调整动态频率

动态的改变就会给系统带来负面影响，影响系统的响应时间，因此选取一个合理的跳变策略降低因动态化带来的系统开销。

### 实现过程

定义系统中当前剩余性能值为 curState，计算方法如下，以此来衡量当前系统整体剩余能力值，考虑到实际情况，当其中任一参数值小于0.1 时，代表该项指标已经过载，此时 curState 整体值应该小于 0.1，其中α=0.5，β=0.3 以及γ=0.2

![image-20200704110031794](https://cdn.jsdelivr.net/gh/zss192/Typora-notes@master/images/image-20200704110031794.png)

如式 (13) 所示，定义当前的跳变频率为hopFrequency,当系统性能现在状态值小于 0.35 时，频率可以动态增加；当目前系统状态值处于 0.25~ 0.35 时，此时为最佳状态，这时应该保持现有的变换频率；当目前系统性能值小于 0.2时，此时系统状态处于饱和状态，应该动态的减慢跳变的频率